services:
  api:
    build:
      context: ./apps/api
    ports:
      - "8000:8080"
    environment:
      # Persist audit logs to the repo root file via the volume below
      AUDIT_LOG_PATH: /app/audit.jsonl
    volumes:
      - ./audit.jsonl:/app/audit.jsonl

  web:
    build:
      context: ./apps/web
    ports:
      - "3000:3000"
    environment:
      # Next.js server-side proxy uses this to reach the backend
      API_BASE_URL: http://api:8080
    depends_on:
      - api
